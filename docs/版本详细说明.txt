【版本说明】
旧版为MiLi提供的基线；新版为Ryan修改开发。以下为按模块归纳的功能差异与优化要点

一、核心与配置框架
- 增强：`fightPosMax` 从 11 提升至 20，支持更多挂机点巡逻路径。
- 增强：新增“挂机点导入/导出”能力（保存至/读取自 `./user/positions-<name>.ini`），便于跨图/多号复用坐标与范围。
- 增强：主配置读取时加入默认值回填与一次性写回逻辑，避免 `nil`/异常值导致 UI 未初始化（`OnPlugLoad` 中的 `needSaveMainDefaults`）。
- 优化：日志与系统提示覆盖面扩大（如保存配置、导入导出点位后的成功提示）。

二、打怪/医生逻辑（mode-fights.lua）
- 新增：Buff 自施放系统 `UseBuffSkills()`，对“心灵之火、石化皮肤、风之领主、极速风暴、天使护盾、回复术、回复温泉、魔力催化”等在无状态时自动补；默认仅在“非医生挂机、目标为怪”时运行，兼顾输出与自保。
- 新增：“治愈术”智能加血（玩家与目标双维度）：
  - 面板可勾选“低于 X% HP 使用治愈术”（`chkUseHealSkill`、`healSkillHpThreshold`），无需将治愈术拖入技能栏。
  - 对目标为“人”时亦可按阈值给目标抬血，减少手动切换。
- 优化：沿途打怪逻辑改进，移动阶段尝试就地攻击命中的怪，再继续移动，减少空跑（`CheckMonsterAlongTheWay()` 即时触发攻击）。
- 健壮性：
  - 目标判空与属性判空更严谨（`hp == nil or hpmax == nil`），规避偶发空引用。
  - 寻路与巡逻索引循环由取余改为显式递增与圈检，适配 20 点并减少死循环概率。
- 兼容：保持 Lua 5.1 习惯用法，未使用 `#` 操作符获取表长（统一使用 `table.getn`）。

三、拾取系统（mode-pick.lua + UI）
- 新增：拾取模式从“背包对照/装备/杂物”扩展为“四档”并默认可“拾取全部物品”。
- 新增：物品名称过滤面板（白名单/黑名单/不过滤 + 18 项物品列表、插入/删除/清空），预留逻辑开关并做 UI 显示同步。暂未对接API无法使用！
- 优化：
  - 拾取延迟范围校验（100–5000ms）与默认回退，避免误设置极值导致卡顿或漏拾。
  - 过滤模式在功能未完全支持时以节流提示方式告知，同时不阻断标准拾取流程。
- 易用：批量渲染 18 条物品名，支持一键清空与逐条删除；支持即时刷新显示。

四、保护与道具（mode-safe.lua + UI）
- 新增：
  - HP 物品位增加为 2 档（低血线/常规阈值），SP 同样 2 档，支持分层消耗策略；优先级：低阈值 > 高阈值。
  - 可定时使用物品位从 4 增至 6，默认间隔 60–65 秒阶梯，支持错峰释放。
  - 全局“最小 1 秒物品使用”节流（含 HP/SP/精灵/定时物品），防止瞬时多次调用引起冷却/交互冲突。
- 增强：
  - 定时喊话参数校验与默认值（内容为空不喊、最小 5 秒），并持久化 UI 与配置一致性。
  - 精灵照护：HP 按阈值用物、满成长值自动用成长道具，均受全局节流保护。
- 组队：
  - 自动邀请与自动确认逻辑更稳健，加入“满队延长检查间隔、找不到本人/空名处理、6–36 秒自适应轮询”。
- 兼容：读取/写入配置时统一缺省值落盘，防止第一次运行或外部修改导致的 `nil` 状态。

五、UI 与交互（plug.xml）
- 面板标题与版本标记：`Ryanの辅助面板 v6.5`。
- 新增分页：
  - 定位点扩展至 20 点，并提供“清空全部点”按钮；新增“导入/导出挂机点”交互区域与文件名输入框。
  - 拾取页新增“物品名称过滤”大块：模式选择、输入框、18 条列表、插入/删除/清空按钮成组排布。
  - 保护页新增 HP1/HP2、SP1/SP2、6 个“定时物品”位，字段更细化，便于拖拽道具到输入框。
  - 独立说明页：集中展示医生挂机与组队 Tips，并加“支持一下”按钮（外链打开）。
- 易用性：
  - 文案统一与默认值优化（例如默认挂机范围 8），输入框与复选框状态和配置文件双向同步更可靠。

六、配置读写与容错
- 读写一致性：所有模块加载后立即将不合法/缺省值写回配置，确保下次启动呈现一致状态。
- 容错增强：诸如 `onlyPickType`、`InPickTime`、`pickFilterMode`、队伍信息等均做边界与空值校验。
- 提示完善：导入/导出、清空点位、过滤列表操作均有系统消息提示。

七、行为细节与策略差异
- 旧版：
  - 挂机点 11、无导入导出、无物品过滤 UI、HP/SP 单档、定时物品 4 位、医生治疗/自保策略较为基础。
  - 巡逻与寻怪逻辑较简，少量 `nil` 判定与重试控制，沿途打怪触发较弱。
- Ryan新版：
  - 路径点 20、导入导出、节流/阈值/默认值体系完善、物品过滤 UI 与后端结构预置、HP/SP 双档与 6 位定时物品。
  - 新增 Buff 自施放与治愈术阈值抬血、沿途打怪即时出手、更多系统提示与健壮性处理。

八、兼容性与版本习惯
- 仍遵循 Lua 5.1 生态，未使用 `#` 取表长，统一以 `table.getn`/显式索引维持兼容。
- UI 资源路径统一为 `texture/ui2022/...`，旧版与新版同目录下可共存，不互相覆盖核心脚本名。

九、可能的影响面与注意事项
- 物品过滤：当前为“显示与管理列表优先”，过滤执行层已作提示节流，后续若启用请注意与服务端拾取接口能力对齐。
- 节流策略：全局 1 秒物品使用限制可能改变旧版“瞬时多物并发”行为，但更符合实际冷却与稳定性。
- 导入导出：文件名为空/不存在会有友好提示；导入会覆盖 UI 展示与内存配置，请先保存当前配置以免丢失。

十、结论
- Ryan 新版在“稳定性、易用性、可配置性、可视化管理”层面全面提升，新增打怪/医生自保策略与 20 点路径、点位导入导出、双档 HP/SP、防抖与节流等改进，适合长时间、多场景挂机；旧版保持基础可用但不具备上述扩展特性。


