# 版本详细说明

旧版为MiLi提供的基线；新版为Ryan修改开发。以下为按模块归纳的功能差异与优化要点

---
本页内容由AI对比原版后智能增量生成

## 一、核心与配置框架

### 挂机点系统重大升级
- **挂机点数量**：从原版的9个提升至20个，支持更复杂的巡逻路径
- **导入导出功能**：新增挂机点导入/导出能力（保存至/读取自 `./user/positions-<name>.ini`），便于跨图/多号复用坐标与范围
- **配置管理优化**：主配置读取时加入默认值回填与一次性写回逻辑，避免 `nil`/异常值导致 UI 未初始化
- **系统提示完善**：日志与系统提示覆盖面扩大（如保存配置、导入导出点位后的成功提示）

## 二、打怪/医生逻辑（mode-fights.lua）

### v7.2 原地挂机系统优化
- **智能返回策略**：超出范围OR范围内没目标时立即返回挂机点，避免无效徘徊
- **优化到达逻辑**：回到挂机点后先检查目标，有目标直接攻击，无目标空闲打坐
- **医生模式智能技能释放**：GetAttackSkillPtr函数增加智能状态检查，只释放目标缺少的状态技能
- **根源问题解决**：从技能选择层面彻底解决重复释放技能的问题，医生模式更加精准高效

### v7.1 智能跟随系统重构
- **双层跟随策略**：强制跟随 + 逻辑跟随，确保跟随无死角
- **智能距离判断**：基于搜索范围的距离检测，性能优异
- **跟随范围限制**：最大25格搜索范围，避免性能问题
- **函数命名规范**：Handle系列函数命名标准化

### v6.5 医生模式优化
- **医生单挂打怪并使用增益技能逻辑优化**：仅当自身没有该状态时才释放相应技能，避免重复施放

### v6.3 治愈术智能化
- **治愈术逻辑重构**：移除检测技能栏中是否存在治愈术，增加治愈术阀值选项配置UI界面
- **智能加血**：可自行设置HP百分比，治愈术无需再拖入技能栏
- **双维度加血**：对目标为"人"时亦可按阈值给目标抬血，减少手动切换

### v5.3 挂机点扩展
- **挂机点数量**：从12个增加至20个点
- **状态提示**：增加提示语"正在前往哪个点"

### v5.1 治愈术自动化
- **治愈术阀值配置**：默认值限定范围0-100，默认85
- **智能检测**：检测技能栏中存在"治愈术"时才会（低于85%）自动加HP

### v4 医生模式逻辑优化
- **医生单挂增益技能条件**：不勾选"医生挂机"并且目标为"怪"
- **医生非单挂治愈术逻辑**：医生挂机选项勾选不勾选都可触发，但目标要为"人"

### v2 医生模式基础功能
- **医生单挂打怪**：给自己加状态和（低于80%）自动加HP功能（需准确设置状态技能CD时间）

### v1 沿途打怪优化
- **沿途打怪逻辑改进**：移动阶段尝试就地攻击命中的怪，再继续移动，减少空跑

### 技术优化
- **目标判空与属性判空更严谨**：`hp == nil or hpmax == nil`，规避偶发空引用
- **寻路与巡逻索引循环优化**：由取余改为显式递增与圈检，适配20点并减少死循环概率

## 三、拾取系统（mode-pick.lua + UI）

### v7.0 革命性升级
- **指定物品拾取模式**：从"过滤模式"升级为"指定物品拾取"，精确控制拾取目标
- **API对接**：`Game.PickItemName(szItemName)`实现按名称精确拾取
- **拖拽式管理**：支持游戏内道具直接拖拽到输入框，操作直观
- **智能物品列表**：16个槽位，支持直接输入和拖拽添加
- **拾取模式系统**：5种拾取模式（全部拾取、仅装备、仅杂物、背包对照、指定物品拾取）
- **延迟控制**：拾取延迟100-5000ms可调，避免过快拾取导致的问题
- **智能过滤**：基于物品名称的精确匹配，避免误拾取

### v6.4 物品过滤功能
- **新增"物品过滤"功能**：（暂无API对接，无法使用）
  - 过滤模式为"不过滤""白名单""黑名单"，默认为"不过滤"
  - 18个物品槽位，支持动态插入与全部清空，支持任意单项删除

### v6.3 拾取功能增强
- **新增"拾取全部"功能**：同时拾取类型默认为"拾取全部"
- **拾取延迟优化**：默认值为500毫秒最低可设100毫秒


## 四、保护与道具（mode-safe.lua + UI）

### v6.3 道具系统重大升级
- **道具使用栏增强**：HP/SP双档(低值与常规)优先使用低值道具 & 6位定时物品
- **道具使用默认值**：HP/SP低值/常规值50/80,定时物品60/61/62/63/64/65
- **自动喊话功能修复与优化**：默认间隔为30秒最低可设5秒

### v6.2 功能稳定性提升
- **道具使用安全时间优化**：改为全局道具

### v6 代码结构优化
- **道具使用安全时间优化**
- **新增道具使用(秒)最小默认值为1**

### 保护机制
- **HP/SP双档保护**：低血线和常规阈值两级保护，分层消耗策略
- **定时物品管理**：6个定时物品位，60-65秒错峰释放
- **全局节流控制**：1秒物品使用限制，防止冲突和冷却问题
- **精灵照护**：智能HP管理和成长道具使用

### 组队与社交
- **自动组队**：智能邀请和确认逻辑，6-36秒自适应轮询
- **定时喊话**：可配置的定时喊话功能，最小5秒间隔
- **状态监控**：实时监控队伍状态和成员情况

## 五、UI 与交互（plug.xml）

### v7.2 界面更新
- **版本标识**：面板标题更新为`Ryanの辅助面板 v7.2`
- **跟随界面**：优化跟随相关控件的布局和交互

### v7.0 界面重构
- **拾取界面重构**：移除复杂的过滤模式选择，简化为直观的指定拾取
- **拖拽支持**：物品列表支持拖拽操作，提升用户体验
- **布局优化**：重新设计物品管理区域，16个槽位布局更合理

### v6.3 UI界面升级
- **UI界面布局优化**
- **说明Tab页面增加"支持一下"按钮**：浏览器跳转到我的页面

### v6.1 导入导出界面
- **UI界面优化**
- **新增挂机点导入导出功能与交互提示**

### v6 功能界面
- **新增挂机点全部清空功能**

### v5.3 界面优化
- **UI界面优化**：详细说明与使用提示独立一标签页

### v5.1 治愈术界面
- **治愈术阀值选项配置UI界面**：可自行设置HP百分比

### 界面特性
- **多页面设计**：挂机、拾取、保护、说明四个主要页面
- **控件丰富**：20个挂机点、16个物品槽位、6个定时物品位
- **交互友好**：拖拽支持、一键清空、批量操作等现代化交互

## 六、配置读写与容错

### v7.0 配置系统标准化
- **字段顺序优化**：确保配置文件结构为`[player][plug][fight][pick][safe]`
- **加载逻辑重构**：移除加载时立即写入的逻辑，避免配置混乱
- **数据一致性**：优化读写机制，确保UI与配置文件完全同步


### 配置特性
- **持久化存储**：所有设置自动保存，重启后完整恢复
- **导入导出**：挂机点支持导入导出，便于多号复用
- **容错处理**：完善的默认值和边界检查，确保配置有效性
- **向后兼容**：新版本可读取旧版本配置，平滑升级

## 七、行为细节与策略差异

### 原版特性
- 挂机点9个、无导入导出、无物品过滤UI、HP/SP单档、定时物品4位、医生治疗/自保策略较为基础
- 巡逻与寻怪逻辑较简，少量`nil`判定与重试控制，沿途打怪触发较弱
- 治愈术需要手动拖入技能栏，无智能加血功能
- 跟随系统简单，容易出现跟丢问题

### Ryan新版特性
- **v7.2**：原地挂机逻辑重构，智能返回策略，医生模式智能技能释放
- **v7.1**：智能跟随系统重构，双层跟随策略，智能距离判断
- **v7.0**：指定物品拾取，拖拽式管理，配置系统标准化
- **v6.5**：医生模式优化，避免重复施放技能
- **v6.4**：物品过滤功能（UI层面）
- **v6.3**：道具系统重大升级，HP/SP双档，6位定时物品
- **v6.2-v6.1**：导入导出功能，挂机点管理优化
- **v6**：代码结构优化，道具使用安全时间
- **v5.3-v5.1**：挂机点扩展至20个，治愈术智能化
- **v5-v4**：医生模式逻辑优化，攻击目标修复
- **v3-v1**：治愈术自动化，沿途打怪优化

## 八、兼容性与版本习惯

- 仍遵循Lua 5.1生态，未使用`#`取表长，统一以`table.getn`/显式索引维持兼容
- UI资源路径统一为`texture/ui2022/...`，旧版与新版同目录下可共存，不互相覆盖核心脚本名

## 九、可能的影响面与注意事项

- **物品过滤**：v7.0已实现指定物品拾取，从"显示与管理列表优先"升级为"精确拾取控制"
- **节流策略**：全局1秒物品使用限制可能改变旧版"瞬时多物并发"行为，但更符合实际冷却与稳定性
- **导入导出**：文件名为空/不存在会有友好提示；导入会覆盖UI展示与内存配置，请先保存当前配置以免丢失
- **医生模式**：v7.2的智能技能释放确保只对玩家目标进行状态检查，避免对怪物等非玩家目标产生意外影响

## 十、技术特性与优势

### 代码架构
- **模块化设计**：main.lua（核心控制）+ mode-*.lua（功能模块）+ plug.xml（界面）
- **状态机模式**：完善的状态管理，确保逻辑清晰可控
- **配置驱动**：大量配置参数，支持个性化定制
- **事件响应**：基于游戏事件的响应机制，实时性强

### 性能优化
- **搜索优化**：智能搜索范围控制，避免性能浪费
- **节流机制**：全局1秒物品使用节流，避免冲突
- **内存管理**：优化对象创建和销毁，减少内存占用
- **响应速度**：优化关键路径，提升用户操作响应速度

### 稳定性保障
- **异常处理**：完善的错误处理和恢复机制
- **边界检查**：严格的参数验证和边界条件处理
- **兼容性**：保持Lua 5.1兼容，确保在不同环境下稳定运行
- **向后兼容**：新版本可读取旧版本配置，平滑升级

### 用户体验
- **操作简化**：复杂功能简单化，降低学习成本
- **交互现代化**：支持拖拽等现代交互方式
- **反馈及时**：实时状态反馈和操作提示
- **个性化**：丰富的配置选项，满足不同用户需求

## 十一、应用场景与优势

### 长时间挂机
- **20个挂机点**：支持大范围巡逻，避免单点竞争
- **智能跟随**：队伍挂机时自动跟随队长，保持队形
- **自动保护**：HP/SP双档保护，确保角色安全
- **Buff管理**：自动补充增益状态，保持最佳战斗状态

### 多角色管理
- **配置导出**：挂机点配置可导出复用，快速部署
- **队伍协作**：医生模式支持队友状态管理
- **个性化设置**：每个角色可独立配置，满足不同职业需求

### 精确拾取控制
- **指定物品拾取**：只拾取有价值的物品，避免背包杂乱
- **拖拽管理**：直观的物品列表管理，操作简单高效
- **实时调整**：可随时调整拾取列表，适应不同场景

## 十二、系统要求与注意事项

### 系统要求
- **客户端要求**：需要支持API调用的客户端
- **编码要求**：代码文件使用GB2312编码
- **Lua版本**：兼容Lua 5.1，保持广泛兼容性

### 使用注意
- **首次使用**：建议先备份原有配置
- **功能测试**：新功能建议先在安全环境测试
- **性能监控**：大范围搜索可能影响性能，建议合理设置范围

### 升级建议
- **v6.x → v7.0**：重点关注物品拾取功能的变化
- **v7.0 → v7.1**：重点关注跟随系统的优化
- **v7.1 → v7.2**：重点关注原地挂机和医生模式的优化
- **配置迁移**：新版本自动处理配置迁移，无需手动操作

## 十三、结论

Ryan版本经过v7.2的原地挂机优化、v7.1的智能跟随重构和v7.0的物品拾取革新，已经发展成为一个功能完善、性能优异、用户体验出色的综合性挂机辅助系统。

**v7.2的原地挂机系统**解决了挂机逻辑不稳定的问题，更重要的是通过智能技能释放逻辑彻底解决了医生模式重复释放技能的核心痛点；**v7.1的智能跟随系统**解决了传统跟随的稳定性问题，实现了真正智能的队伍协作；**v7.0的指定物品拾取**提供了前所未有的精确控制能力，让用户可以精确管理背包内容。

相比原版，Ryan版本在挂机点数量（9→20）、医生模式智能化、跟随系统稳定性、物品拾取精确性、道具系统完善度等方面都有重大提升，为用户提供了一个稳定、高效、智能的挂机解决方案，适合各种长时间挂机场景和多角色管理需求。

---

*本文档全面介绍了Ryan版本从v1到v7.2的所有功能特性和技术优势，帮助用户充分了解和使用系统的各项能力。*